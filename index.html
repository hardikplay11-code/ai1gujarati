<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ai1 Gujarati - Snacks Store</title>

  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    :root{ --accent:#ff9933; --wh:#25d366; --bg:#fff4e0; --card:#fff; }
    body { font-family: 'Segoe UI', Roboto, Arial, sans-serif; background: var(--bg); color:#3a2e25; }

    header { 
      position: sticky; top:0; 
      background:#fff4e0; padding:18px 12px; 
      display:flex; align-items:center; justify-content:space-between;
      z-index:1000;
    }
    header h1 { font-size:20px; font-weight:800; }

    /* Cart Icon Badge */
    #cartBadge {
      position:absolute; 
      top:-6px; right:-10px;
      background:#ff9933;
      color:white;
      padding:2px 6px;
      border-radius:50%;
      font-size:12px;
    }

    .slider { width: 100%; height: 300px; overflow: hidden; }
    .slides { display: flex; width: 300%; height: 100%; animation: slide 12s infinite; }
    .slides img { width:100%; height:100%; object-fit:cover; }
    @keyframes slide { 
      0% { transform: translateX(0); } 
      33% { transform: translateX(-100%); } 
      66% { transform: translateX(-200%); } 
      100% { transform: translateX(0); } 
    }
.section-title {
  text-align: center;
  font-size: 32px;
  font-weight: 800;
  margin-top: 40px;
  margin-bottom: 20px;
  color: #3a2e25; /* dark color to match theme */
}

    .container{ max-width:1100px; margin:0 auto; padding:18px; }
    .products { 
      padding: 18px 0 40px; 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); 
      gap: 18px; 
    }
    .card { 
      background: var(--card); 
      border-radius: 14px; 
      padding: 14px; 
      box-shadow: 0 6px 18px rgba(0,0,0,0.08); 
      position:relative; 
      display:flex; flex-direction:column; gap:8px;
    }

    .actions{ display:flex; gap:8px; margin-top:10px; align-items:center; }
    .btn { display:inline-flex; align-items:center; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; border:none; }
    .whatsapp-btn{ background:var(--wh); color:#fff; text-decoration:none; }
    .cart-btn{ background:var(--accent); color:#fff; }

    /* -------------------------------------------------------- */
    /* üî• PREMIUM BOTTOM SHEET CART (B2) */
    /* -------------------------------------------------------- */
    #cartSheet {
      position: fixed;
      left: 0;
      right: 0;
      bottom: -100%;
      height: 72%;
      background: #ffffffcc;
      backdrop-filter: blur(12px);
      border-radius: 24px 24px 0 0;
      box-shadow: 0 -10px 25px rgba(0,0,0,0.15);
      transition: bottom .35s cubic-bezier(.25,.8,.25,1);
      z-index: 9999;
      padding: 20px;
      overflow-y: auto;
    }

    #cartSheet.show {
      bottom: 0;
    }

    .cart-item {
      display: flex;
      gap: 12px;
      padding: 12px;
      border-radius: 14px;
      background: white;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }

    .cart-item img {
      width: 68px;
      height: 68px;
      border-radius: 12px;
      object-fit: cover;
    }

    .cart-info { flex: 1; }

    .cart-title { font-size: 16px; font-weight: 700; }
    .cart-weight { font-size: 13px; color:#777; margin-top: 2px; }

    .cart-qty {
      display:flex; align-items:center; gap:10px; margin-top:8px;
    }
    .cart-qty button{
      width:30px; height:30px; 
      background:#ff9933; border:none; color:white; 
      border-radius:8px; font-size:18px; cursor:pointer;
    }

    .cart-remove{
      font-size:13px; color:red; cursor:pointer; margin-top:5px;
    }

    #cartTotalBar {
      position: sticky;
      bottom: 0;
      background: white;
      padding: 14px 18px;
      border-radius: 16px;
      box-shadow: 0 -5px 15px rgba(0,0,0,0.12);
      margin-top: 12px;
    }

    #checkoutBtn {
      width: 100%;
      padding: 14px;
      background: #ff9933;
      border: none;
      color: white;
      font-size: 18px;
      font-weight: 700;
      border-radius: 14px;
      margin-top: 10px;
      cursor: pointer;
    }

    /* -------------------------------------------------------- */
    /* üåü ORDER SHEET (Single product) */
    /* -------------------------------------------------------- */
    #orderSheet {
      position: fixed;
      left: 0;
      right: 0;
      bottom: -110%;
      height: 78%;
      background: #ffffffee;
      backdrop-filter: blur(10px);
      border-radius: 20px 20px 0 0;
      box-shadow: 0 -12px 30px rgba(0,0,0,0.18);
      transition: bottom .35s cubic-bezier(.25,.8,.25,1);
      z-index: 10010;
      padding: 18px;
      overflow-y: auto;
    }
    #orderSheet.show { bottom: 0; }

    .order-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .order-product { display:flex; gap:12px; align-items:center; padding:12px; background:white; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
    .order-product img { width:80px; height:80px; object-fit:cover; border-radius:10px; }
    .order-product .meta { flex:1; }
    .order-meta-title { font-weight:800; font-size:16px; }
    .order-meta-weight { font-size:13px; color:#666; margin-top:4px; }

    .order-qty { display:flex; gap:10px; align-items:center; margin-top:10px; }
    .order-qty button { width:36px; height:36px; border-radius:10px; background:var(--accent); color:white; border:none; font-size:20px; cursor:pointer; }

    .order-actions { display:flex; gap:10px; margin-top:12px; }
    .order-actions .btn { flex:1; text-align:center; }

    .order-info { margin-top:14px; }
    .order-info .fc-field { margin-top:8px; width:100%; padding:10px; border-radius:8px; border:1px solid #ddd; }

    .order-price { margin-top:12px; display:flex; justify-content:space-between; font-weight:800; font-size:18px; }

    /* small responsiveness */
    @media (max-width:520px){
      .order-product img { width:72px; height:72px; }
      #orderSheet { height: 86%; }
    }
  </style>
</head>

<body>

<header>
  <div class="brand" style="display:flex; align-items:center; gap:10px;">
    <img src="logo.jpeg" alt="logo" style="height:42px; width:42px; object-fit:cover; border-radius:4px;">
    <h1>Ai1 Gujarati Snacks</h1>
  </div>

  <!-- Cart Icon -->
  <div style="display:flex; align-items:center; gap:16px;">
    <a href="products.html"
       style="text-decoration:none; font-weight:700; color:#d65a00;">Products</a>

<div style="display:flex; align-items:center; gap:16px;">
    <a href="about us.html"
       style="text-decoration:none; font-weight:700; color:#d65a00;">About Us</a>

    <div class="Whatsapp"><a href="https://wa.me/917984090490" style=" display:inline-block; padding:12px 18px; background:#25d366; color:white; font-weight:700; text-decoration:none; border-radius:10px; margin:10px 0; display:inline-flex; align-items:center; gap:8px; ">üí¨ Chat on WhatsApp</a></div>

    <div onclick="openCartSheet()" style="cursor:pointer; position:relative; font-size:22px;">
      üõí
      <span id="cartBadge">0</span>
    </div>
  </div>
</header>


<!-- ===================== HERO SECTION ===================== -->
<section class="hero-section" 
style="
  background: url('ff5b89f8-d0eb-4445-abab-c01da799b390.png');
  background-size: cover;
  background-position: center;
  padding: 80px 20px;
  text-align: center;
  color: white;
  font-weight: 700;
">
<div class="homepage-logo">
  <img src="logo.jpeg" style="height:402px; width:402px; object-fit:cover; border-radius:40px alt="Ai1 Gujarati Logo">
</div>
  
<h1 style="font-size: 42px; text-shadow: 0 4px 15px rgba(0,0,0,0.5);">
    Authentic Gujarati Snacks ‚Äì Home Delivered

  </h1>

  <p style="font-size: 18px; margin-top: 12px; text-shadow: 0 3px 10px rgba(0,0,0,0.4);">
    Taste the tradition of Gujarat in every bite.
  </p>


</section>

<!-- ===================== WHAT WE SERVE ===================== -->
<section style="padding: 50px 20px; background: #fff;">
  <h2 style="text-align:center; font-size:28px; font-weight:800; color:#d65a00;">What We Serve</h2>
  <p style="max-width:700px; margin:12px auto; text-align:center; font-size:16px;">
    We deliver freshly prepared, hygienic, and authentic Gujarati snacks across India.
    From crispy Khakhra to spicy Bhakharvadi, everything is made with premium ingredients.
  </p>

  <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap; margin-top:30px;">
    <div style="background:#fff4e0; padding:20px; border-radius:14px; width:280px; text-align:center;">
      <h3>Freshly Made</h3>
      <p>All items are made fresh per order to maintain quality & taste.</p>
    </div>

    <div style="background:#fff4e0; padding:20px; border-radius:14px; width:280px; text-align:center;">
      <h3>Premium Ingredients</h3>
      <p>No compromise. Only the best spices and ingredients used.</p>
    </div>

    <div style="background:#fff4e0; padding:20px; border-radius:14px; width:280px; text-align:center;">
      <h3>Fast Delivery</h3>
      <p>We ship your snacks quickly so they reach you super fresh.</p>
    </div>
  </div>
</section>
<h2 class="section-title">Products</h2>
<main class="container">
  <section class="products">

    <!-- PRODUCT 1 -->
    <div class="card" data-name="Methi Khakhra" data-price="135">
      <img src="methi-khakhra.png" alt="Methi Khakhra">
      <h3>Methi Khakhra</h3>
      <div class="price">‚Çπ135</div>
      <div class="actions">
        <select class="qty-box">
          <option value="500g">500g</option>
          <option value="1kg">1kg</option>
        </select>
        <button class="btn whatsapp-btn" onclick="openOrderSheet(this.closest('.card'))">Order Now</button>
        <button class="btn cart-btn" onclick="addCartFromCard(this.closest('.card'))">Add to Cart</button>
      </div>
    </div>

    <!-- PRODUCT 2 -->
    <div class="card" data-name="Sev" data-price="80">
      <img src="sev.png" alt="Sev">
      <h3>Sev</h3>
      <div class="price">‚Çπ80</div>
      <div class="actions">
        <select class="qty-box">
          <option value="250g">250g</option>
          <option value="500g">500g</option>
        </select>
        <button class="btn whatsapp-btn" onclick="openOrderSheet(this.closest('.card'))">Order Now</button>
        <button class="btn cart-btn" onclick="addCartFromCard(this.closest('.card'))">Add to Cart</button>
      </div>
    </div>

    <!-- PRODUCT 3 -->
    <div class="card" data-name="Bhakharvadi" data-price="90">
      <img src="bhakharvadi.png" alt="Bhakharvadi">
      <h3>Bhakharvadi</h3>
      <div class="price">‚Çπ90</div>
      <div class="actions">
        <select class="qty-box">
          <option value="250g">250g</option>
          <option value="500g">500g</option>
        </select>
        <button class="btn whatsapp-btn" onclick="openOrderSheet(this.closest('.card'))">Order Now</button>
        <button class="btn cart-btn" onclick="addCartFromCard(this.closest('.card'))">Add to Cart</button>
      </div>
    </div>

  
</section>

<!-- ===================== CUSTOMER REVIEWS (UPLOAD) ===================== -->
<section id="reviews" style="padding:50px 20px; background:#fff;">
  <h2 style="text-align:center; font-size:28px; font-weight:800; color:#d65a00;">
    Customer Reviews
  </h2>

  <div style="max-width:600px; margin:30px auto; background:#fff4e0; padding:20px; border-radius:16px;">
    <input id="revName" placeholder="Your Name" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;">
    <textarea id="revText" placeholder="Write your review..." rows="3"
      style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;"></textarea>

    <div id="starRating" style="font-size:26px; margin-bottom:10px;">
      <span onclick="setRating(1)">‚òÜ</span>
      <span onclick="setRating(2)">‚òÜ</span>
      <span onclick="setRating(3)">‚òÜ</span>
      <span onclick="setRating(4)">‚òÜ</span>
      <span onclick="setRating(5)">‚òÜ</span>
    </div>

    <input type="file" id="revImage" accept="image/*" style="margin-bottom:10px;">

    <button onclick="submitReview()" 
      style="width:100%; padding:12px; background:#ff9933; color:white; font-weight:700; border:none; border-radius:10px;">
      Submit Review
    </button>
  </div>

  <div id="reviewList" style="display:flex; gap:20px; flex-wrap:wrap; justify-content:center;"></div>
</section>

<div style="text-align:center; margin: 30px 0;">

  <a href="products.html"
 style="
      display:inline-block;
      padding:14px 24px;
      background:#ff9933;
      color:white;
      font-size:18px;
      font-weight:700;
      border-radius:12px;
      text-decoration:none;
  ">More Products</a>
</div>

<!-- ===================== PRODUCT HIGHLIGHT ===================== -->
<section style="padding:50px 20px; background:#fffaf2;">
  <h2 style="text-align:center; font-size:28px; font-weight:800; color:#d65a00;">
    Why Our Products Are Special?
  </h2>

  <ul style="max-width:700px; margin:20px auto; font-size:16px; line-height:28px;">
    <li>‚úî 100% homemade Gujarati snacks</li>
    <li>‚úî Prepared fresh after receiving order</li>
    <li>‚úî Pure ingredients, no preservatives</li>
    <li>‚úî Hygienically packed and sealed</li>
    <li>‚úî Crunchy, flavourful & traditional taste</li>
  </ul>
</section>

<!-- ===================== CUSTOMER REVIEWS ===================== -->
<section style="padding:50px 20px; background:white;">
  <h2 style="text-align:center; font-size:28px; font-weight:800; color:#d65a00;">
    What Our Customers Say
  </h2>

  <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap; margin-top:30px;">
    
    <div style="background:#fff4e0; padding:20px; border-radius:14px; width:260px;">
      <p>‚ÄúBest Methi Khakhra I ever tasted! Very crispy and fresh.‚Äù</p>
      <strong>- Harshil</strong>
    </div>

    <div style="background:#fff4e0; padding:20px; border-radius:14px; width:260px;">
      <p>‚ÄúBhakharvadi was amazing! Perfect balance of sweet & spicy.‚Äù</p>
      <strong>- Priya</strong>
    </div>

    <div style="background:#fff4e0; padding:20px; border-radius:14px; width:260px;">
      <p>‚ÄúDelivery was fast & packaging was neat. Highly recommend!‚Äù</p>
      <strong>- Mehul</strong>
    </div>

  </div>
</section>

</main>


<!-- üî• PREMIUM BOTTOM CART SHEET -->
<div id="cartSheet">
  
  <!-- MINIMIZE BUTTON -->
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h2 style="font-size:20px;font-weight:800;">üõí Your Cart</h2>
    <button onclick="minimizeCartSheet()" 
      style="background:#fff; border:1px solid #ddd; border-radius:50%; width:34px; height:34px; font-size:18px; cursor:pointer;">
      ‚Üì
    </button>
  </div>

  <div style="height:12px;"></div>

  
  <div id="cartItems"></div>

  <div id="cartTotalBar">
    <div style="display:flex; justify-content:space-between; font-size:16px;">
      <span>Subtotal</span>
      <span id="cartSubtotal">‚Çπ0</span>
    </div>

    <button id="checkoutBtn" onclick="continueCheckout()">Continue to Checkout</button>
  </div>
</div>

<!-- ===================== ORDER SHEET (2C) ===================== -->
<div id="orderSheet" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="order-header">
    <div style="font-weight:800; font-size:18px;">Buy</div>
    <button onclick="closeOrderSheet()" style="background:transparent;border:none;font-size:20px;cursor:pointer;">‚úï</button>
  </div>

  <div class="order-product">
    <img id="os_img" src="" alt="product">
    <div class="meta">
      <div class="order-meta-title" id="os_name">Product</div>
      <div class="order-meta-weight" id="os_weight">500g</div>

      <div class="order-qty">
        <button onclick="changeOrderQty(-1)">‚àí</button>
        <div id="os_qty" style="font-weight:800; font-size:18px;">1</div>
        <button onclick="changeOrderQty(1)">+</button>
      </div>
    </div>
    <div style="font-weight:800; font-size:18px;" id="os_line">‚Çπ0</div>
  </div>

  <div style="margin-top:12px;">
    <label style="font-weight:700; font-size:14px;">Select weight</label>
    <select id="os_weight_sel" style="width:100%; padding:10px; margin-top:8px; border-radius:8px; border:1px solid #ddd;">
    </select>
  </div>

  <div class="order-info">
    <input id="os_name_field" class="fc-field order-info" placeholder="Full name">
    <input id="os_phone_field" class="fc-field order-info" placeholder="Phone number">
    <input id="os_house" class="fc-field order-info" placeholder="House / Flat No.">
    <input id="os_street" class="fc-field order-info" placeholder="Street / Area">
    <div style="display:flex; gap:8px;">
      <input id="os_city" class="fc-field order-info" placeholder="City" style="flex:1;">
      <input id="os_pin" class="fc-field order-info" placeholder="Pincode" style="width:110px;">
    </div>
  </div>

  <div style="margin-top:14px; display:flex; gap:10px;">
    <button class="btn cart-btn" style="flex:1;" onclick="addOrderToCart()">Add to Cart</button>
    <button class="btn whatsapp-btn" style="flex:1;" onclick="buyNow()">Buy Now</button>
  </div>

  <div class="order-price" style="margin-top:16px;">
    <div>Subtotal</div>
    <div id="os_total">‚Çπ0</div>
  </div>
</div>

<!-- OLD fullOrderPage kept but not used in 2C - left for compatibility -->
<div id="fullOrderPage" style="display:none;">
  <div class="full-order-header" style="
      padding:20px; 
      background:#ff9933; 
      color:white; 
      font-size:20px; 
      font-weight:800; 
      display:flex; 
      align-items:center;
    ">
    <span class="full-order-back" onclick="closeFullOrder()" style="cursor:pointer; margin-right:12px; font-size:26px;">‚Üê</span>
    Complete Your Order
  </div>

  <div style="padding:20px;">
    <h3 id="fullProductTitle" style="font-size:18px; margin-bottom:14px; color:#d65a00;"></h3>
    <div id="priceBreak" class="price-box">
      <div class="price-line"><span>Subtotal</span><span id="pb_sub">‚Çπ0</span></div>
      <div class="price-total">Total: <span id="pb_total">‚Çπ0</span></div>
    </div>
  </div>
</div>

<script>
function minimizeCartSheet(){
  document.getElementById("cartSheet").classList.remove("show");
}

/* ============================================================
   MERGED SCRIPT: Cart (B2) + Order Sheet (2C)
   Uses your Apps Script URL: the one you previously provided.
   ============================================================ */

const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxXGK5MY1jk4M8yBhQKEQjWu3SXoPfQK4rsgGgi-ibKl00eF60OdhaADE1fBZOZrU-0lA/exec";

let cart = [];

/* ------------------ Utilities ------------------ */
const weightMultipliers = { "250g": 1, "500g": 2, "1kg": 4 };

function safeParseInt(v){ return parseInt(String(v||"0").replace(/[^\d]/g,''),10) || 0; }

function findProductPrice(name){
  const card = [...document.querySelectorAll(".card")].find(c => c.dataset.name === name);
  return safeParseInt(card?.dataset?.price);
}

/* ------------------ CART (B2) functions ------------------ */

function openCartSheet(){ document.getElementById("cartSheet").classList.add("show"); }
function closeCartSheet(){ document.getElementById("cartSheet").classList.remove("show"); }

function addCartFromCard(card){
  const name = card.dataset.name;
  const weight = card.querySelector(".qty-box").value;

  const existing = cart.find(i => i.name === name && i.weight === weight);
  if(existing) existing.qty++;
  else cart.push({ name, weight, qty:1 });

  renderCart();
  loadReviews();
  openCartSheet();
}

function renderCart(){
  const box = document.getElementById("cartItems");
  let subtotal = 0;

  if(!box) return;

  if(cart.length === 0){
    box.innerHTML = `<p style="padding:20px;">Your cart is empty.</p>`;
    document.getElementById("cartSubtotal").innerText = "‚Çπ0";
    document.getElementById("cartBadge").innerText = "0";
    return;
  }

  let html = "";
  cart.forEach((item, index)=>{
    const price = findProductPrice(item.name);
    let mult;
if (item.name === "Methi Khakhra") {
    mult = item.weight === "1kg" ? 2 : 1;  // 500g = 1, 1kg = 2
} else {
    mult = weightMultipliers[item.weight] || 1;
}
    
    const line = price * mult * item.qty;
    subtotal += line;

    const img = item.name.toLowerCase().replace(/ /g, "-") + ".jpg";

    html += `
      <div class="cart-item">
        <img src="${img}" alt="${item.name}">
        <div class="cart-info">
          <div class="cart-title">${item.name}</div>
          <div class="cart-weight">${item.weight}</div>

          <div class="cart-qty">
            <button onclick="changeCartQty(${index}, -1)">‚àí</button>
            <span id="cart-qty-${index}" style="font-weight:700;">${item.qty}</span>
            <button onclick="changeCartQty(${index}, 1)">+</button>
          </div>

          <div class="cart-remove" onclick="removeCartItem(${index})">Remove</div>
        </div>

        <div style="font-weight:700; font-size:15px;">‚Çπ${line}</div>
      </div>
    `;
  });

  box.innerHTML = html;
  document.getElementById("cartSubtotal").innerText = "‚Çπ" + subtotal;
  document.getElementById("cartBadge").innerText = cart.reduce((a,b)=>a + (parseInt(b.qty||1,10)||1), 0);
}

function changeCartQty(i, d){
  cart[i].qty = Math.max(1, (parseInt(cart[i].qty||1,10) || 1) + d);
  document.getElementById(`cart-qty-${i}`).innerText = cart[i].qty;
  renderCart();
  loadReviews();
}

function removeCartItem(i){
  cart.splice(i,1);
  renderCart();
  loadReviews();
}

function continueCheckout(){
  closeCartSheet();
  // open order sheet in "Multiple Items" mode: we will create order from cart
  openOrderSheetForCart();
}

/* ------------------ ORDER SHEET (2C) functions ------------------ */

let os_current = { name: "", weight: "500g", qty:1, unit:0 };
function openOrderSheet(card){
  // card can be either a DOM card element OR product data object
  let name, weight, unit;
  if(card instanceof Element){
    name = card.dataset.name;
    weight = card.querySelector(".qty-box")?.value || "500g";
    unit = findProductPrice(name);
  } else if (typeof card === "object"){
    name = card.name; weight = card.weight; unit = card.unit || findProductPrice(card.name);
  } else {
    return;
  }

  os_current.name = name;
  os_current.weight = weight;
  os_current.qty = 1;
  os_current.unit = unit;

  // fill UI
  document.getElementById("os_img").src = name.toLowerCase().replace(/ /g,"-") + ".jpg";
  document.getElementById("os_name").innerText = name;
  document.getElementById("os_weight").innerText = weight;
  document.getElementById("os_qty").innerText = os_current.qty;

  // populate weight selector from the product card options if available
  const cardEl = [...document.querySelectorAll(".card")].find(c => c.dataset.name === name);
  const sel = document.getElementById("os_weight_sel");
  sel.innerHTML = "";
  if(cardEl){
    cardEl.querySelectorAll('.qty-box option').forEach(o=>{
      const op = document.createElement("option");
      op.value = o.value; op.text = o.text;
      sel.appendChild(op);
    });
    sel.value = os_current.weight;
  } else {
    // fallback
    sel.innerHTML = '<option value="500g">500g</option><option value="250g">250g</option><option value="1kg">1kg</option>';
    sel.value = os_current.weight;
  }

  // reset form fields (keep if user had values? here we clear for fresh)
  document.getElementById("os_name_field").value = "";
  document.getElementById("os_phone_field").value = "";
  document.getElementById("os_house").value = "";
  document.getElementById("os_street").value = "";
  document.getElementById("os_city").value = "";
  document.getElementById("os_pin").value = "";

  computeOrderSheetPrice();
  document.getElementById("orderSheet").classList.add("show");
}

function openOrderSheetForCart(){
  // special mode: create summary product in sheet showing first item and mention "Multiple Items"
  if(cart.length === 0) {
    // if cart empty just open generic sheet
    openOrderSheet({ name: "Items", weight: "", unit: 0 });
    return;
  }
  // produce combined info: we will show a compact summary and total
  os_current.name = "Multiple Items";
  os_current.weight = "";
  os_current.qty = 1;
  os_current.unit = 0;

  document.getElementById("os_img").src = "cart.jpg";
  document.getElementById("os_name").innerText = "Multiple Items";
  document.getElementById("os_weight").innerText = cart.map(i=>`${i.name} (${i.weight}) √ó ${i.qty}`).join(" | ");
  document.getElementById("os_qty").innerText = "‚Äî";
  document.getElementById("os_weight_sel").innerHTML = '<option value="">Multiple</option>';
  computeOrderSheetPrice();
  document.getElementById("orderSheet").classList.add("show");
}

function closeOrderSheet(){
  document.getElementById("orderSheet").classList.remove("show");
}

/* Qty controls in order sheet */
function changeOrderQty(delta){
  if(os_current.name === "Multiple Items") return;
  os_current.qty = Math.max(1, (parseInt(os_current.qty || 1,10) || 1) + delta);
  document.getElementById("os_qty").innerText = os_current.qty;
  computeOrderSheetPrice();
}

/* when weight changes */
document.addEventListener('change', function(e){
  if(e.target && e.target.id === "os_weight_sel"){
    os_current.weight = e.target.value;
    document.getElementById("os_weight").innerText = os_current.weight;
    computeOrderSheetPrice();
  }
});

/* compute price for sheet */
function computeOrderSheetPrice(){
  let subtotal = 0;

  if(os_current.name === "Multiple Items"){
    // Sum cart items with special-case for Methi Khakhra
    cart.forEach(i=>{
      const p = findProductPrice(i.name);

      // SPECIAL RULE: Methi Khakhra uses 500g = 1, 1kg = 2
      let mult;
      if(i.name === "Methi Khakhra"){
        mult = i.weight === "1kg" ? 2 : 1;
      } else {
        // default mapping: 250g => 1, 500g => 2, 1kg => 4 (keeps current app logic)
        mult = weightMultipliers[i.weight] || 1;
      }

      subtotal += p * mult * (parseInt(i.qty || 1, 10) || 1);
    });

  } else {
    // Single product / order-sheet mode (non-multiple)
    const unit = os_current.unit || findProductPrice(os_current.name) || 0;

    let mult;
    if(os_current.name === "Methi Khakhra"){
      mult = os_current.weight === "1kg" ? 2 : 1;
    } else {
      mult = weightMultipliers[os_current.weight] || 1;
    }

    subtotal = unit * mult * (parseInt(os_current.qty || 1,10) || 1);
  }

  document.getElementById("os_line").innerText = "‚Çπ" + subtotal;
  document.getElementById("os_total").innerText = "‚Çπ" + subtotal;
}

/* Add to cart from order sheet */
function addOrderToCart(){
  if(os_current.name === "Multiple Items"){
    // nothing to add - maybe open cart
    openCartSheet();
    closeOrderSheet();
    return;
  }
  const existing = cart.find(i => i.name === os_current.name && i.weight === os_current.weight);
  if(existing) existing.qty = existing.qty + (parseInt(os_current.qty || 1,10) || 1);
  else cart.push({ name: os_current.name, weight: os_current.weight, qty: parseInt(os_current.qty || 1,10) || 1 });

  renderCart();
  loadReviews();
  // feedback & close
  openCartSheet();
  closeOrderSheet();
}

/* Buy Now -> Submit directly (single product or multiple items) */
function buyNow(){
  // gather details
  const buyer = document.getElementById("os_name_field").value.trim();
  const phone = document.getElementById("os_phone_field").value.trim();

  if(!buyer || !phone){
    alert("Please enter name and phone number.");
    return;
  }

  // prepare items and amount
  let itemsStr = "";
  let amount = 0;
  if(os_current.name === "Multiple Items"){
    itemsStr = cart.map(i=>`${i.name} (${i.weight}) √ó ${i.qty}`).join(" | ");
    cart.forEach(i=>{
      const p = findProductPrice(i.name);
     
      let mult;
      if(i.name === "Methi Khakhra"){
          mult = i.weight === "1kg" ? 2 : 1;
      } else {
          mult = weightMultipliers[i.weight] || 1;
      }
      amount += p * mult * i.qty;
    });
  } else {
    itemsStr = `${os_current.name} ‚Äî ${os_current.weight} √ó ${os_current.qty}`;
    const unit = os_current.unit || findProductPrice(os_current.name) || 0;
    const m = weightMultipliers[os_current.weight] || 1;
    amount = unit * m * (parseInt(os_current.qty||1,10) || 1);
  }

  const data = {
    name: buyer,
    phone,
    items: itemsStr,
    amount,
    house: document.getElementById("os_house").value || "",
    street: document.getElementById("os_street").value || "",
    city: document.getElementById("os_city").value || "",
    pincode: document.getElementById("os_pin").value || "",
    timestamp: new Date().toISOString()
  };

   fetch(APPS_SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

cart = [];
renderCart();
  loadReviews();
  alert("Order submitted! We received your order.");
  closeOrderSheet();
}


function closeFullOrder(){ document.getElementById("fullOrderPage").style.display="none"; }
function minimizeCartSheet(){ document.getElementById("cartSheet").classList.remove("show"); }

/* ------------------ initialize ------------------ */

/* ===== CUSTOMER REVIEW SCRIPT ===== */
const REVIEW_API = "https://script.google.com/macros/s/AKfycbxgyM0GRYnt3dgU22ADxVTZR0PBiFE9WZFD7DCaxXrOlW3dshsiUwrsB5jeNci3JVeh/exec";
let selectedRating = 0;

function setRating(r){
  selectedRating = r;
  document.querySelectorAll("#starRating span").forEach((s,i)=>{
    s.textContent = i < r ? "‚òÖ" : "‚òÜ";
  });
}

function submitReview(){
  const name = revName.value.trim();
  const text = revText.value.trim();
  const imgFile = revImage.files[0];

  if(!name || !text || selectedRating === 0){
    alert("Please fill all fields & rating");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(){
    const review = { name, text, rating: selectedRating, img: reader.result };
    const reviews = JSON.parse(localStorage.getItem("reviews") || "[]");
    reviews.push(review);
    localStorage.setItem("reviews", JSON.stringify(reviews));
    revName.value = ""; revText.value = ""; revImage.value = ""; setRating(0);
    loadReviews();
  };
  if(imgFile) reader.readAsDataURL(imgFile);
}

function loadReviews(){
  const box = document.getElementById("reviewList");
  if(!box) return;
  box.innerHTML = "";
  const reviews = JSON.parse(localStorage.getItem("reviews") || "[]");
  reviews.forEach(r=>{
    box.innerHTML += `
      <div style="width:260px; background:#fff4e0; padding:16px; border-radius:14px;">
        <img src="${r.img}" style="width:100%; height:160px; object-fit:cover; border-radius:10px;">
        <div style="margin-top:8px; font-size:18px; color:#ff9933;">
          ${"‚òÖ".repeat(r.rating)}${"‚òÜ".repeat(5-r.rating)}
        </div>
        <p style="margin:6px 0;">"${r.text}"</p>
        <strong>- ${r.name}</strong>
      </div>
    `;
  });
}
/* ===== END CUSTOMER REVIEW SCRIPT ===== */

document.addEventListener('DOMContentLoaded', function(){
  renderCart();
  loadReviews();
});

</script>

<div class="footer">
  ¬© 2025 Ai1 Gujarati Snacks ‚Äî Freshly Made & Delivered Across India
</div>

</body>
<script src="main-cart.js"></script>

</html>






