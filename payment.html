<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Confirm Payment - Ai1 Gujarati Snacks</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff4e0;
      padding: 20px;
      color: #3a2e25;
    }
    .box {
      max-width: 450px;
      background: white;
      margin: auto;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    button {
      width: 100%;
      padding: 14px;
      margin-top: 15px;
      background: #ff9933;
      color: white;
      border: none;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      opacity: 0.9;
    }
    .upi-img {
      width: 100%;
      border-radius: 10px;
      margin: 10px 0;
    }
  </style>
</head>
<body>

<div class="box">
  <h2>Confirm Your Payment</h2>

  <p><strong>Order Amount:</strong> â‚¹<span id="amount"></span></p>

  <h3>Choose Payment Method:</h3>

  <button onclick="selectMethod('COD')">Cash on Delivery (COD)</button>

  <h3>OR Pay Using UPI:</h3>
  <img src="IMG-20251114-WA0000.jpg" class="upi-img" alt="UPI QR">

  <button onclick="selectMethod('UPI')">I Have Paid (UPI)</button>

  <button id="confirmBtn" onclick="confirmPayment()" style="display:none; background:#28a745;">Confirm Payment</button>
</div>


<script>
// ------------------------------
// READ URL ORDER DATA
// ------------------------------
let urlParams = new URLSearchParams(window.location.search);
let amount = urlParams.get("amount");
let orderDataRaw = urlParams.get("data");

document.getElementById("amount").innerText = amount;

let orderData = {};
try {
  orderData = JSON.parse(decodeURIComponent(orderDataRaw));
} catch {
  orderData = {};
}


// ------------------------------
// PAYMENT METHOD SELECT
// ------------------------------
let selectedMethod = "";

function selectMethod(method) {
  selectedMethod = method;
  document.getElementById("confirmBtn").style.display = "block";
  alert(method + " selected. Now click Confirm Payment.");
}


// ------------------------------
// SAVE ORDER TO GOOGLE SHEET + SEND EMAIL
// ------------------------------
function confirmPayment() {
  if (!selectedMethod) {
    alert("Please select payment method first.");
    return;
  }

  const finalOrder = {
    orderId: "ORD-" + Math.floor(1000 + Math.random() * 9000),
    name: orderData.name || "",
    phone: orderData.phone || "",
    house: orderData.house || "",
    street: orderData.street || "",
    city: orderData.city || "",
    pin: orderData.pin || "",
    items: JSON.stringify(orderData.cart || []),
    amount: amount,
    method: selectedMethod,
    time: new Date().toLocaleString()
  };

  // ----------- SEND TO GOOGLE SHEET --------------
  fetch(
    "https://script.google.com/macros/s/AKfycbwBTRZg31Ay7QrLZpWNo8arWkDLIUk1jQmY8dtW8G-eO5o6aG9qZj_12345/exec",
    {
      method: "POST",
      body: JSON.stringify(finalOrder),
    }
  );

  // ----------- SEND EMAIL --------------
  fetch(
    "https://script.google.com/macros/s/AKfycbwLJ12345abcdEFGH/sendOrderEmail",
    {
      method: "POST",
      body: JSON.stringify(finalOrder),
    }
  );

  alert("Payment Confirmed! Your order has been placed.");
  window.location.href = "index.html";
}
</script>

</body>
</html>
